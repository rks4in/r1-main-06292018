package com.tomtom.navui.input.intent;

import android.content.Intent;

import com.tomtom.navui.appkit.AppContext;
import com.tomtom.navui.systemport.SystemContext;
import com.tomtom.navui.systemport.systemcomponents.ScreenSystemComponent;

import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.robolectric.RobolectricTestRunner;
import org.robolectric.annotation.Config;

import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.Matchers.is;
import static org.hamcrest.Matchers.nullValue;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

@RunWith(RobolectricTestRunner.class)
@Config(manifest = "./src/main/AndroidManifest.xml")
public class IntentActionHandlerTest {

    private AppContext mAppContextMock;
    private SystemContext mSystemContextMock;
    private ScreenSystemComponent mScreenSystemComponentMock;

    @Before
    public void setUp() throws Exception {
        mAppContextMock = mock(AppContext.class);
        mSystemContextMock = mock(SystemContext.class);
        mScreenSystemComponentMock = mock(ScreenSystemComponent.class);

        when(mSystemContextMock.getComponent(ScreenSystemComponent.class)).thenReturn(mScreenSystemComponentMock);
        when(mAppContextMock.getSystemPort()).thenReturn(mSystemContextMock);
    }

    /**
     * We need check if Launch intent is not parsed
     */
    @Test
    public void testShouldRecognizeLaunchIntent() {

        // GIVEN parser and intent which is generated by android when user lunch application from
        // main menu
        final IntentActionHandler iah = new IntentActionHandler(mAppContextMock);
        final Intent launchIntent = getLaunchIntent();

        final boolean expected = true; // yes this is Launch intent.
        // WHEN checking
        final boolean Launch = iah.isLaunchIntent(launchIntent);
        // THEN
        assertThat(Launch, is(expected));
    }

    public Intent getLaunchIntent() {
        final Intent launchIntent = new Intent(Intent.ACTION_MAIN);
        launchIntent.addCategory(Intent.CATEGORY_LAUNCHER);
        return launchIntent;
    }

    /**
     * We need check if Launch intent is not parsed
     */
    @Test
    public void testShouldRecognizeLaunchIntentBoundaryConditions() {

        // GIVEN parser and null intent 
        final IntentActionHandler iah = new IntentActionHandler(mAppContextMock);
        final Intent launchIntent = null; // BoundaryConditions
        final boolean expected = true; // yes for use null is Launch intent because parser can't do
                                 // nothing with null
        // WHEN checking ..
        final boolean launch = iah.isLaunchIntent(launchIntent);
        // THEN
        assertThat(launch, is(expected));
    }

    /**
     * We need check if launch intent is handled
     */
    @Test
    public void testShouldRecognizeLaunchIntentHandled() {

        // GIVEN parser and intent which is generated by android when user lunch application from
        // main menu
        final IntentActionHandler iah = new IntentActionHandler(mAppContextMock);

        Exception ex = null;
        // WHEN checking..
        try {
            iah.handle(null); // here we test boundary condition.
        } catch (final Exception e) {
            ex = e;
        }
        // THEN
        assertThat(ex, is(nullValue()));// We count that application don't get any exceptions
    }
}
